<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üî• DeFiRE Calculator üî•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a1a, #ff6600);
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .calculator {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 15px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.8);
    }
    input {
      padding: 10px;
      margin: 10px;
      width: 80%;
      border-radius: 8px;
      border: none;
      font-size: 1em;
    }
    button {
      padding: 12px 20px;
      margin-top: 15px;
      background: #ff6600;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #ff8533;
    }
    .result {
      margin-top: 20px;
      font-size: 1.3em;
      font-weight: bold;
    }
    .wallet-status {
      margin: 15px;
      font-size: 1em;
      color: #00ffcc;
    }
  </style>
</head>
<body>
  <h1>üî• DeFiRE Calculator üî•</h1>
  <h2>built on TRON</h2>
  <h3>Created by FootballAlien$</h3>
  <p class="wallet-status" id="walletStatus">Connect Wallet to Begin</p>
  <button onclick="connectWallet()">Connect Tron Wallet</button>

  <div class="calculator" id="calc" style="display:none;">
    <h2>Financial Independence Calculator</h2>
    <input type="number" id="annualSpending" placeholder="Annual Spending ($)" />
    <input type="number" id="currentSavings" placeholder="Current Savings ($)" />
    <input type="number" id="annualSavings" placeholder="Annual Savings ($)" />
    <input type="number" id="investmentReturn" placeholder="Expected Annual Return (%)" />
    <button onclick="calculateFIRE()">Calculate FIRE Date</button>
    <div class="result" id="result"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.js"></script>
  <script>
    const OWNER_WALLET = "TY691Xr2EWgKJmHfm7NWKMRJjojLmS2cma";
    const FBA_CONTRACT = "TNW5ABkp3v4jfeDo1vRVjxa3gtnoxP3DBN";
    const MIN_TOKENS = 1000;

    async function connectWallet() {
      if (!window.tronWeb || !window.tronWeb.ready) {
        document.getElementById("walletStatus").innerText =
          "‚ùå TronLink not detected. Install TronLink extension or app.";
        return;
      }

      const wallet = window.tronWeb.defaultAddress.base58;
      document.getElementById("walletStatus").innerText = "üîÑ Checking access for: " + wallet;

      // Always whitelist your own wallet
      if (wallet === OWNER_WALLET) {
        grantAccess(wallet);
        return;
      }

      try {
        const contract = await window.tronWeb.contract().at(FBA_CONTRACT);
        const balance = await contract.balanceOf(wallet).call();

        // balance comes in SUN (like 6 decimals usually) ‚Üí convert to readable
        const decimals = 6; // adjust if FBA has different decimals
        const tokenBalance = parseInt(balance.toString()) / (10 ** decimals);

        if (tokenBalance >= MIN_TOKENS) {
          grantAccess(wallet, tokenBalance);
        } else {
          denyAccess(wallet, tokenBalance);
        }
      } catch (err) {
        console.error(err);
        document.getElementById("walletStatus").innerText =
          "‚ö†Ô∏è Error fetching token balance. Please retry.";
      }
    }

    function grantAccess(wallet, tokens = null) {
      document.getElementById("walletStatus").innerText =
        `‚úÖ Access Granted: ${wallet}` + (tokens ? ` (FBA: ${tokens})` : "");
      document.getElementById("calc").style.display = "block";
    }

    function denyAccess(wallet, tokens) {
      document.getElementById("walletStatus").innerText =
        `‚õî Access Denied: ${wallet} (FBA: ${tokens})`;
      document.getElementById("calc").style.display = "none";
    }

    function calculateFIRE() {
      const spending = parseFloat(document.getElementById("annualSpending").value);
      const current = parseFloat(document.getElementById("currentSavings").value);
      const savings = parseFloat(document.getElementById("annualSavings").value);
      const returnRate = parseFloat(document.getElementById("investmentReturn").value) / 100;

      if (isNaN(spending) || isNaN(current) || isNaN(savings) || isNaN(returnRate)) {
        document.getElementById("result").innerText = "‚ö†Ô∏è Please fill all fields.";
        return;
      }

      const target = spending * 25; // 4% rule
      let balance = current;
      let years = 0;

      while (balance < target && years < 100) {
        balance = balance * (1 + returnRate) + savings;
        years++;
      }

      if (years >= 100) {
        document.getElementById("result").innerText = "üö´ FIRE not achievable in 100 years.";
      } else {
        document.getElementById("result").innerText =
          `üéâ You can retire in ${years} years with $${balance.toFixed(2)}.`;
      }
    }
  </script>
</body>
</html>
